<?php

/**
 * @file
 * Page callback: islandora_map_browse.
 *
 * See islandora_map_browse_menu()
 */
function map_browse_config($form, &$form_state) {

  $form['map_browse_all_link'] = array(
    '#markup' => "<label>Browse Repository URL (requires a static map file generated by the following link)</label>" . variable_get('map_browse_site_base') . "/browsemap",
  );

  $form['map_generate_link'] = array(
    '#markup' => "<label>Copy link into a browser to generate static map file</label>" . variable_get('map_browse_site_base') .'/islandora/search/' . variable_get('map_browse_coord_field') . ':&#91;*&nbsp;TO&nbsp;*&#93?type=edismax&islandora_solr_search_navigation=0&solr_profile=MapGEOJSONViewAll&width=1000&height=800&iframe=true&generate=yes',
  );

  $form['map_browse_fedora_base'] = array(
    '#type' => 'textfield',
    '#title' => t('Fedora base URL'),
    '#default_value' => variable_get('map_browse_fedora_base', 'http://yourFedoraHostname.ca'),
    '#size' => 80,
    '#maxlength' => 256,
    '#description' => t('The internet accessable address of your fedora server'),
    '#required' => TRUE,
  );

  $form['map_browse_site_base'] = array(
    '#type' => 'textfield',
    '#title' => t('Web server base URL'),
    '#default_value' => variable_get('map_browse_site_base', 'http://yourwebsite.ca'),
    '#size' => 80,
    '#maxlength' => 256,
    '#description' => t('The internet accessable address of your web server'),
    '#required' => TRUE,
  );

  $form['map_browse_fedora_prefix'] = array(
    '#type' => 'textfield',
    '#title' => t('Fedora base prefix'),
    '#default_value' => variable_get('map_browse_fedora_prefix', '/islandora/object/'),
    '#size' => 60,
    '#maxlength' => 256,
    '#description' => t('Path from hostname to PID'),
    '#required' => TRUE,
  );

  $form['map_browse_fedora_suffix'] = array(
    '#type' => 'textfield',
    '#title' => t('Fedora base Thumbnail suffix'),
    '#default_value' => variable_get('map_browse_fedora_suffix', '/datastream/TN/view'),
    '#size' => 60,
    '#maxlength' => 256,
    '#description' => t('Path after PID'),
    '#required' => TRUE,
  );


  $form['map_browse_config_warning'] = array(
    '#markup' => "<label>Any changes made to the fields returned from solr require you regenerate the static map file.</label>",
  );

  $form['map_browse_coord_field'] = array(
    '#type' => 'textfield',
    '#title' => t('Solr Coordinate Field'),
    '#default_value' => variable_get('map_browse_coord_field', 'mods_subject_cartographics_coordinates_ms'),
    '#size' => 40,
    '#maxlength' => 128,
    '#description' => t('MODS field containing coordinates in Latitude/Longitude format'),
    '#required' => TRUE,
  );

  $form['map_browse_title_field'] = array(
    '#type' => 'textfield',
    '#title' => t('Solr field to use for title on map popups'),
    '#default_value' => variable_get('map_browse_title_field', 'dc.title'),
    '#size' => 40,
    '#maxlength' => 128,
    '#description' => t('Solr field containing title'),
    '#required' => TRUE,
  );

  $form['map_browse_return_fields'] = array(
    '#type' => 'textarea',
    '#title' => t('Solr fields to return for popup'),
    '#default_value' => variable_get('map_browse_return_fields', 'subject, dc.subject | description, dc.description'),
    '#cols' => 100,
    '#rows' => 5,
    '#description' => t('Fields to be displayed on map popups. The format of this field is: Field Name , solr.field |Field Name2 , solr.field2 | etc...'),
    '#required' => TRUE,
  );

  $form['map_browse_map_centre'] = array(
    '#type' => 'textfield',
    '#title' => t('Default Map Centre'),
    '#default_value' => variable_get('map_browse_map_centre', '52.1311, -106.6353'),
    '#size' => 40,
    '#maxlength' => 128,
    '#description' => t('Centre of the Universe'),
    '#required' => TRUE,
  );

  $form['map_browse_map_zoom'] = array(
      '#type' => 'textfield',
      '#title' => t('Default Map Zoom'),
      '#default_value' => variable_get('map_browse_map_zoom', '8'),
      '#size' => 3,
      '#maxlength' => 3,
      '#description' => t('Default Map Zoom'),
      '#required' => TRUE,
  );

  $form['mapquest_key'] = array(
    '#type' => 'textfield',
    '#title' => t('Map Quest Key'),
    '#default_value' => variable_get('mapquest_key', ''),
    '#size' => 60,
    '#maxlength' => 128,
    '#description' => t('https://developer.mapquest.com/plans'),
    '#required' => TRUE,
  );

  return system_settings_form($form);
}